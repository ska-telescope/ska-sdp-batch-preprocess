variables:
  GIT_SUBMODULE_STRATEGY: recursive
  DEBIAN_FRONTEND: "noninteractive"

stages:
  - lint
  - scan
  - build
  - test
  - publish
  - pages

include:
  - project: "ska-telescope/templates-repository"
    file: 
     - "gitlab-ci/includes/python.gitlab-ci.yml"
     - "gitlab-ci/includes/docs.gitlab-ci.yml"
     - "gitlab-ci/includes/finaliser.gitlab-ci.yml"
     - "gitlab-ci/includes/release.gitlab-ci.yml"

python-test:
  image: vmorello/skao-ci-portable-dp3:latest
  before_script:
    - ls /opt
    - env
    - DP3 --version
    - echo Path is $PATH
    - echo poetry version is $CI_POETRY_VERSION
    - |
      echo "Installing poetry"
      python3 -m venv $HOME/poetry_venv
      source $HOME/poetry_venv/bin/activate
      pip install poetry==$CI_POETRY_VERSION
      deactivate
      PATH=$HOME/poetry_venv/bin:$PATH
      poetry config virtualenvs.in-project true
    - |
      echo "python-test: Installing with poetry";
      time poetry install --all-extras;
